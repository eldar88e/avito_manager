<% content_for :title do %>
  Магазин <%= @store.manager_name %>
  <% if !@store.percent.zero? %>
    <span class="percent"><%= '+' if @store.percent.positive?  %><%= "#{@store.percent}" %>%</span>
  <% end %>
<% end %>

<% content_for :head do %>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;apikey=369d354e-0df0-4d9d-bb3a-08bc6a532a15" type="text/javascript"></script>
<% end %>

<%= turbo_frame_tag @store do %>
  <div class="container mx-auto px-5">
    <div class="flex gap-3">
      <%= button_to 'Обновить feed', store_update_feed_path(@store),
                    class: 'loader-btn btn btn-success btn-upd-feed',
                    data: { controller: 'btn_preloader', action: 'click->btn_preloader#call' } %>

      <%= button_to 'Обновить Black list', store_update_ban_list_path(@store),
                    class: 'loader-btn btn btn-dark' %>
      <%= link_to 'Авито', store_avito_dashboard_path(@store), class: 'btn btn-primary', data: { turbo: false } %>
    </div>

    <div data-controller="tabs" data-tabs-active-tab-classes="border-b-2 border-indigo-600 text-indigo-600" data-tabs-inactive-tab-classes="text-gray-500 hover:text-gray-700">
      <!-- Tabs (buttons) -->
      <div role="tablist" aria-label="Store sections" class="flex flex-wrap gap-2 border-b">
        <button type="button"
                role="tab"
                data-action="click->tabs#switch"
                data-tabs-target="tab"
                aria-selected="true"
                class="px-3 py-2 text-sm font-medium -mb-px border-b-2 border-transparent focus:outline-none">
          Основная информация
        </button>

        <button type="button"
                role="tab"
                data-action="click->tabs#switch"
                data-tabs-target="tab"
                aria-selected="false"
                class="px-3 py-2 text-sm font-medium -mb-px border-b-2 border-transparent focus:outline-none">
          Адреса магазина
        </button>

        <button type="button"
                role="tab"
                data-action="click->tabs#switch"
                data-tabs-target="tab"
                aria-selected="false"
                class="px-3 py-2 text-sm font-medium -mb-px border-b-2 border-transparent focus:outline-none">
          Слои картинки
        </button>

        <button type="button"
                role="tab"
                data-action="click->tabs#switch"
                data-tabs-target="tab"
                aria-selected="false"
                class="px-3 py-2 text-sm font-medium -mb-px border-b-2 border-transparent focus:outline-none">
          Объявления
        </button>
      </div>

      <!-- Panels -->
      <div class="mt-3">
        <!-- 1 -->
        <section role="tabpanel" data-tabs-target="panel" class="">
          <a href="<%= edit_store_path(@store.id) %>" class="mb-3 inline-flex items-center rounded-lg bg-yellow-500 px-3 py-2 text-white hover:bg-yellow-600">Edite</a>

          <ul class="divide-y rounded-lg border">
            <% @store.attributes.each do |key, value| %>
              <% next if key.match?(/^id|created_at|updated_at/) %>
              <li class="p-3 overflow-hidden">
                <strong class="font-semibold"><%= key %>:</strong>
                <span class="ml-1"><%= key.match?(/description|desc_ad_import|desc_product/) ? value.html_safe : value %></span>
              </li>
            <% end %>
          </ul>
        </section>

        <!-- 2 -->
        <section role="tabpanel" data-tabs-target="panel" class="hidden">
          <div class="flex justify-end">
            <%= render partial: '/addresses/new_address_btn', locals: { store: @store } %>
          </div>

          <ul class="mb-3 divide-y rounded-lg border p-3 mt-3" id="addresses">
            <%= render @addresses %>
          </ul>

          <%= turbo_frame_tag :test_img do %>
            <%= render partial: '/stores/test_img' %>
          <% end %>
        </section>

        <!-- 3 -->
        <section role="tabpanel" data-tabs-target="panel" class="hidden">
          <%= render partial: '/image_layers/new_image_layer_btn', locals: { store: @store } %>

          <ol class="list-decimal rounded-lg border p-3" id="image_layers">
            <%= render @image_layers %>
          </ol>
        </section>

        <!-- 4 -->
        <section role="tabpanel" data-tabs-target="panel" class="hidden">
          <%= turbo_frame_tag :ads do %>
            <%= render partial: '/ads/ads_list' %>
          <% end %>
        </section>
      </div>
    </div>
  </div>
<% end %>
